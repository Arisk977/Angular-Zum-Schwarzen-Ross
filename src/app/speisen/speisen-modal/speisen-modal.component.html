<div class="modal-header">
  <h4 class="modal-title">{{ title }}</h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>
<div class="modal-body">

  <!-- üßæ Standard Ansicht -->
  <ng-container *ngIf="!isSizeSelectionActive && !isDeleteIngredientsActive; else sizeOrDeleteView">
    <ng-container *ngIf="gerichte.length > 0; else keineDaten">
      <app-speisen-gruppe
        *ngFor="let gruppe of groupByUnterkategorie(gerichte)"
        [gruppe]="gruppe"
        (gerichtSelected)="openDeleteIngredients($event)">
      </app-speisen-gruppe>
    </ng-container>

    <ng-template #keineDaten>
      <p>‚ùå Keine Gerichte in dieser Kategorie gefunden.</p>
    </ng-template>
  </ng-container>

  <!-- üçï Gr√∂√üenwahl oder Zutaten l√∂schen -->
  <ng-template #sizeOrDeleteView>

    <!-- üçï Schritt 1: Gr√∂√üenwahl -->
    <ng-container *ngIf="isSizeSelectionActive; else deleteIngredientsView">
      <div class="fade-slide">
        <h5 class="mb-3">{{ selectedDish?.name }}</h5>
        <p class="text-muted mb-3">{{ selectedDish?.beschreibung }}</p>
        <h3 class="h6 mb-3">Bitte Gr√∂√üe ausw√§hlen:</h3>

        <div class="size-selection d-flex flex-column gap-2">
          <label class="form-check">
            <input type="radio" class="form-check-input me-2" name="pizzaSize" value="30 cm" [(ngModel)]="selectedSize" />
            <span class="form-check-label">30 cm</span>
          </label>

          <label class="form-check">
            <input type="radio" class="form-check-input me-2" name="pizzaSize" value="40 cm" [(ngModel)]="selectedSize" />
            <span class="form-check-label">40 cm</span>
          </label>
        </div>
      </div>
    </ng-container>

    <!-- üßæ Schritt 2: Zutaten entfernen -->
    <ng-template #deleteIngredientsView>
      <div class="fade-slide">
        <app-delete-ingredients
          [gericht]="selectedDish!"
          (back)="backToList()"
          (selectionSubmitted)="handleIngredientDelete($event)">
        </app-delete-ingredients>
      </div>
    </ng-template>

  </ng-template>
</div>

<!-- ================= FOOTER ================= -->
<div class="modal-footer navigation-footer">
  <!-- Standard Footer -->
  <ng-container *ngIf="!isSizeSelectionActive && !isDeleteIngredientsActive; else footerSwitch">
    <button class="arrow-btn" (click)="navigate('prev')" [disabled]="currentIndex === 0"> ‚Üê </button>
    <span class="page-info">{{ currentIndex + 1 }} / {{ kategorien.length }}</span>
    <button class="arrow-btn" (click)="navigate('next')" [disabled]="currentIndex === kategorien.length - 1"> ‚Üí </button>
  </ng-container>

  <!-- Footer f√ºr Gr√∂√üenwahl oder DeleteIngredients -->
  <ng-template #footerSwitch>

    <!-- üçï Footer bei Gr√∂√üenwahl -->
    <ng-container *ngIf="isSizeSelectionActive; else deleteIngredientsFooter">
      <div class="delete-footer fade-slide d-flex justify-content-between align-items-center w-100">
        <button type="button" class="btn btn-outline-secondary px-4" (click)="backToList()">Zur√ºck</button>
        <button
          type="button"
          class="btn btn-primary px-4"
          [disabled]="!selectedSize"
          (click)="selectSizeAndContinue()"
        >
          Weiter
        </button>
      </div>
    </ng-container>

    <!-- üßæ Footer f√ºr DeleteIngredients -->
    <ng-template #deleteIngredientsFooter>
      <div class="delete-footer fade-slide d-flex justify-content-between align-items-center w-100">
        <button type="button" class="btn btn-outline-secondary px-4" (click)="backToList()">Zur√ºck</button>
        <button type="button" class="btn btn-primary px-4" (click)="triggerSubmitFromFooter()">Weiter</button>
      </div>
    </ng-template>

  </ng-template>
</div>
