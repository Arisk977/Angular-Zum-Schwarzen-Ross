<div class="modal-header">
  <h4 class="modal-title">{{ title }}</h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>


<div class="modal-body">
  <!-- Standard Ansicht (Gerichtsliste) -->
  <ng-container
    *ngIf="!isSizeSelectionActive && !isDeleteIngredientsActive && !isAddIngredientsActive && !isOverviewActive; else stepView">
    <ng-container *ngIf="gerichte.length > 0; else keineDaten">
      <app-speisen-gruppe *ngFor="let gruppe of groupByUnterkategorie(gerichte)" [gruppe]="gruppe"
        (gerichtSelected)="openDeleteIngredients($event)">
      </app-speisen-gruppe>
    </ng-container>

    <ng-template #keineDaten>
      <p>‚ùå Keine Gerichte in dieser Kategorie gefunden.</p>
    </ng-template>
  </ng-container>

  <!-- Steps 1‚Äì4 -->
  <ng-template #stepView>

    <!-- üçï Step 1: Gr√∂√üenwahl -->
    <ng-container *ngIf="isSizeSelectionActive">
      <div class="fade-slide">
        <h5 class="mb-3">{{ selectedDish?.name }}</h5>
        <p class="text-muted mb-3">{{ selectedDish?.beschreibung }}</p>
        <h3 class="h6 mb-3">Bitte Gr√∂√üe ausw√§hlen:</h3>

        <div class="size-selection d-flex flex-column gap-2">
          <label class="form-check">
            <input type="radio" class="form-check-input me-2" name="pizzaSize" value="30 cm"
              [(ngModel)]="selectedSize" />
            <span class="form-check-label">30 cm</span>
          </label>

          <label class="form-check">
            <input type="radio" class="form-check-input me-2" name="pizzaSize" value="40 cm"
              [(ngModel)]="selectedSize" />
            <span class="form-check-label">40 cm</span>
          </label>
        </div>
      </div>
    </ng-container>

    <!-- üßæ Step 2: Zutaten entfernen -->
    <ng-container *ngIf="isDeleteIngredientsActive">
      <div class="fade-slide">
        <app-delete-ingredients [gericht]="selectedDish!" (back)="backToList()"
          (selectionSubmitted)="handleDeleteIngredientDelete($event)">
        </app-delete-ingredients>
      </div>
    </ng-container>

    <!-- üßÇ Step 3: Zutaten hinzuf√ºgen -->
    <ng-container *ngIf="isAddIngredientsActive">
      <div class="fade-slide">
        <app-add-ingredients [gericht]="selectedDish!" (back)="backToDelete()"
          (selectionSubmitted)="handleAddIngredients($event)">
        </app-add-ingredients>
      </div>
    </ng-container>

    <!-- üìù Step 4: √úbersicht -->
    <ng-container *ngIf="isOverviewActive">
      <div class="fade-slide">
        <app-overview [gericht]="selectedDish!" [selectedSize]="selectedSize" [deletedIngredients]="deletedIngredients"
          [addedIngredients]="addedIngredients" [title]="title" (back)="backToAddIngredients()"
          (addToCart)="finalizeOrder()">
        </app-overview>

      </div>
    </ng-container>

  </ng-template>
</div>

<div class="modal-footer navigation-footer">

  <!-- üìú Standard Footer (Kategorie-Navigation) -->
  <ng-container
    *ngIf="!isSizeSelectionActive && !isDeleteIngredientsActive && !isAddIngredientsActive && !isOverviewActive; else stepFooter">
    <button class="arrow-btn" (click)="navigate('prev')" [disabled]="currentIndex === 0"> ‚Üê </button>
    <span class="page-info">{{ currentIndex + 1 }} / {{ kategorien.length }}</span>
    <button class="arrow-btn" (click)="navigate('next')" [disabled]="currentIndex === kategorien.length - 1"> ‚Üí
    </button>
  </ng-container>

  <!-- üß≠ Schritt-Footer -->
  <ng-template #stepFooter>

    <!-- üçï Step 1: Gr√∂√üenwahl -->
<ng-container *ngIf="isSizeSelectionActive">
  <div class="footer d-flex justify-content-between w-100 fade-slide">
    <button type="button" class="btn-outline-ross" (click)="backToList()">Zur√ºck</button>
    <button type="button" class="btn-ross" [disabled]="!selectedSize" (click)="selectSizeAndContinue()">
      Weiter
    </button>
  </div>
</ng-container>

<!-- üßæ Step 2 -->
<ng-container *ngIf="isDeleteIngredientsActive">
  <div class="footer d-flex justify-content-between w-100 fade-slide">
    <button type="button" class="btn-outline-ross" (click)="backToList()">Zur√ºck</button>
    <button type="button" class="btn-ross" (click)="triggerSubmitFromFooter()">Weiter</button>
  </div>
</ng-container>

<!-- üßÇ Step 3 -->
<ng-container *ngIf="isAddIngredientsActive">
  <div class="footer d-flex justify-content-between w-100 fade-slide">
    <button type="button" class="btn-outline-ross" (click)="backToDelete()">Zur√ºck</button>
    <button type="button" class="btn-ross" (click)="triggerAddIngredientsSubmit()">Weiter</button>
  </div>
</ng-container>


    <!-- üìù Step 4: √úbersicht -->
    <ng-container *ngIf="isOverviewActive">
      <div class="footer d-flex justify-content-between w-100 fade-slide">
        <button type="button" class="btn btn-outline-secondary px-4" (click)="backToAddIngredients()">Zur√ºck</button>
        <button type="button" class="btn btn-success px-4" (click)="finalizeOrder()">üõí In den Warenkorb</button>
      </div>
    </ng-container>

  </ng-template>
</div>