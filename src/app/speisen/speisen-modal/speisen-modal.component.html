<div class="modal-header">
  <h4 class="modal-title">{{ title }}</h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>


<div class="modal-body">
  <!-- Standard Ansicht (Gerichtsliste) -->
  <ng-container
    *ngIf="!isDeleteIngredientsActive && !isAddIngredientsActive && !isOverviewActive; else stepView">
    <ng-container *ngIf="gerichte.length > 0; else keineDaten">
      <app-speisen-gruppe *ngFor="let gruppe of groupByUnterkategorie(gerichte)" [gruppe]="gruppe"
        (gerichtSelected)="openDishOverview($event)">
      </app-speisen-gruppe>
    </ng-container>

    <ng-template #keineDaten>
      <p>‚ùå Keine Gerichte in dieser Kategorie gefunden.</p>
    </ng-template>
  </ng-container>

  <!-- Steps 1‚Äì4 -->
  <ng-template #stepView>
    <!-- üßæ Step 2: Zutaten entfernen -->
    <ng-container *ngIf="isDeleteIngredientsActive">
      <div class="fade-slide">
        <app-delete-ingredients [gericht]="selectedDish!" (back)="backToList()"
          (selectionChanged)="liveDeleteUpdate($event)" (selectionSubmitted)="handleDeleteIngredientDelete($event)">
        </app-delete-ingredients>
      </div>
    </ng-container>

    <!-- üßÇ Step 3: Zutaten hinzuf√ºgen -->
    <ng-container *ngIf="isAddIngredientsActive">
      <div class="fade-slide">
        <app-add-ingredients [gericht]="selectedDish!"
          (selectionChanged)="liveAddUpdate($event)" (selectionSubmitted)="handleAddIngredients($event)">
        </app-add-ingredients>
      </div>
    </ng-container>

    <!-- üìù Step 4: √úbersicht -->
    <ng-container *ngIf="isOverviewActive">
      <div class="fade-slide">

        <app-overview [gericht]="selectedDish!" [selectedSize]="selectedSize" [deletedIngredients]="deletedIngredients"
          [addedIngredients]="addedIngredients" [title]="title" [finalPrice]="finalPrice"   (sizeChanged)="onSizeChanged($event)"
          [extraPrice]="calculateExtraPrice()" [basePrice]="basePrice" (goToDelete)="goToDeleteIngredients()"
          (goToAdd)="goToAddIngredients()">
        </app-overview>


      </div>
    </ng-container>


  </ng-template>
</div>

<div class="modal-footer navigation-footer">

  <!-- üìú Standard Footer (Kategorie-Navigation) -->
  <ng-container
    *ngIf="!isDeleteIngredientsActive && !isAddIngredientsActive && !isOverviewActive; else stepFooter">
    <button class="arrow-btn" (click)="navigate('prev')" [disabled]="currentIndex === 0"> ‚Üê </button>
    <span class="page-info">{{ currentIndex + 1 }} / {{ kategorien.length }}</span>
    <button class="arrow-btn" (click)="navigate('next')" [disabled]="currentIndex === kategorien.length - 1"> ‚Üí
    </button>
  </ng-container>

  <!-- üß≠ Schritt-Footer -->
  <ng-template #stepFooter>

   <ng-container *ngIf="isDeleteIngredientsActive">
  <div class="footer d-flex justify-content-end w-100 fade-slide align-items-center gap-3">
    <div class="preis-live me-3">
      {{ finalPrice | currency:'EUR':'symbol':'1.2-2' }}
    </div>
    <button type="button" class="btn-ross" (click)="triggerSubmitFromFooter()">
      Best√§tigen
    </button>
  </div>
</ng-container>



 <ng-container *ngIf="isAddIngredientsActive">
  <div class="footer d-flex justify-content-end w-100 fade-slide align-items-center gap-3">
    <div class="preis-live me-3">
      {{ finalPrice | currency:'EUR':'symbol':'1.2-2' }}
    </div>
    <button type="button" class="btn-ross" (click)="triggerAddIngredientsSubmit()">
      Best√§tigen
    </button>
  </div>
</ng-container>



    <!-- üìù Step 4: √úbersicht -->
    <ng-container *ngIf="isOverviewActive">
      <div class="fade-slide align-items-center">
        <button type="button" class="btn btn-success px-4" (click)="finalizeOrder()">üõí In den Warenkorb</button>
      </div>
    </ng-container>


  </ng-template>

</div>