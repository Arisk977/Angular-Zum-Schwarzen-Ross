<div class="modal-header">
  <h4 class="modal-title">{{ title }}</h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>


<div class="modal-body">
  <!-- Standard Ansicht (Gerichtsliste) -->
  <ng-container
    *ngIf="!isDeleteIngredientsActive && !isAddIngredientsActive && !isOverviewActive; else stepView">
    <ng-container *ngIf="gerichte.length > 0; else keineDaten">
      <app-speisen-gruppe *ngFor="let gruppe of groupByUnterkategorie(gerichte)" [gruppe]="gruppe"
        (gerichtSelected)="openDishOverview($event)">
      </app-speisen-gruppe>
    </ng-container>

    <ng-template #keineDaten>
      <p>‚ùå Keine Gerichte in dieser Kategorie gefunden.</p>
    </ng-template>
  </ng-container>

  <!-- Steps 1‚Äì4 -->
  <ng-template #stepView>
    <!-- üßæ Step 2: Zutaten entfernen -->
    <ng-container *ngIf="isDeleteIngredientsActive">
      <div class="fade-slide">
        <app-delete-ingredients [gericht]="selectedDish!"   [preselected]="deletedIngredients"
          (selectionChanged)="liveDeleteUpdate($event)" (selectionSubmitted)="handleDeleteIngredient($event)">
        </app-delete-ingredients>
      </div>
    </ng-container>

    <!-- üßÇ Step 3: Zutaten hinzuf√ºgen -->
    <ng-container *ngIf="isAddIngredientsActive">
      <div class="fade-slide">
        <app-add-ingredients [gericht]="selectedDish!" [title]="title"  [preselectedExtras]="addedIngredients" [disabledAddSauces]="disabledAddSauces"
          (selectionChanged)="liveAddUpdate($event)" (selectionSubmitted)="handleAddIngredients($event)">
        </app-add-ingredients>
      </div>
    </ng-container>

    <!-- üìù Step 4: √úbersicht -->
    <ng-container *ngIf="isOverviewActive">
      <div class="fade-slide">

        <app-overview [gericht]="selectedDish!" [selectedSize]="selectedSize" [deletedIngredients]="deletedIngredients"
          [addedIngredients]="addedIngredients" [title]="title" [finalPrice]="finalPrice"   (sizeChanged)="onSizeChanged($event)"
          [extraPrice]="calculateExtraPrice()" [basePrice]="basePrice" (goToDelete)="goToDeleteIngredients()"
          (goToAdd)="goToAddIngredients()">
        </app-overview>


      </div>
    </ng-container>


  </ng-template>
</div>

<div class="modal-footer navigation-footer">

  <!-- üìú Standard Footer (Kategorie-Navigation) -->
  <ng-container
    *ngIf="!isDeleteIngredientsActive && !isAddIngredientsActive && !isOverviewActive; else stepFooter">
    <button class="arrow-btn" (click)="navigate('prev')" [disabled]="currentIndex === 0"> ‚Üê </button>
    <span class="page-info">{{ currentIndex + 1 }} / {{ kategorien.length }}</span>
    <button class="arrow-btn" (click)="navigate('next')" [disabled]="currentIndex === kategorien.length - 1"> ‚Üí
    </button>
  </ng-container>

  <!-- üß≠ Schritt-Footer -->
  <ng-template #stepFooter>

   <ng-container *ngIf="isDeleteIngredientsActive">
  <div class="footer-buttons">
    <div class="preis-live me-3">
      {{ finalPrice | currency:'EUR':'symbol':'1.2-2' }}
    </div>
    <app-button (click)="triggerSubmitFromFooter()" text="Best√§tigen" shadowColor="rgba(0, 0, 0, 0.5)" textColor="white" backgroundColor="rgb(160,0,0)"></app-button>

  </div>
</ng-container>



 <ng-container *ngIf="isAddIngredientsActive">
  <div class="footer-buttons">
    <div class="preis-live me-3">
      {{ finalPrice | currency:'EUR':'symbol':'1.2-2' }}
    </div>
 
<app-button (click)="triggerAddIngredientsSubmit()" text="Best√§tigen" shadowColor="rgba(0, 0, 0, 0.5)" textColor="white" backgroundColor="rgb(160,0,0)"></app-button>

  </div>
</ng-container>



    <!-- üìù Step 4: √úbersicht -->
    <ng-container *ngIf="isOverviewActive">
      <div class="fade-slide align-items-center">
        <app-button (click)="finalizeOrder()" text="üõí In den Warenkorb" shadowColor="rgba(0, 0, 0, 0.5)" textColor="white" backgroundColor="#198754"></app-button>
      </div>
    </ng-container>


  </ng-template>

</div>